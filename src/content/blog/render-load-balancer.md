---
title: The curious case of a slow Render load balancer
generated: 1701894028870
description: asdfas
pubDate: Aug 21, 2024
author: Max McDonnell
---

Last year we migrated from [Supabase to
Render](https://blog.val.town/blog/migrating-from-supabase/). Generally, Render
has been excellent. We have a handful of services, they are easy to monitor and
configure, onboarding is easy. Every now and then we think about what moving to
AWS would be like and we are thankful to not be in the complex sea of orange
buttons.

However.

During our journey to [improve the speed of HTTP
Vals](https://github.com/val-town/val-town-product/discussions/113) we noticed
that there was a surprising amount of latency reaching our Render servers. This
latency wasn't present on all requests, but we think on average it was adding
about 50ms to requests we sent through Render.

You can try it out yourself. I've made two vals, [one that works using our new
load balancer](https://www.val.town/v/maxm/itsOnValTown) (like all Vals), and
[another one](https://www.val.town/v/maxm/itsOnRender) that I've set up to send
through Render's load balancer.

I even had [Townie](https://www.val.town/townie) whip up [a little
tool](https://maxm-governingvioletkrill.web.val.run/) to display the performance
difference between the two.

[![a performance tool to test both urls generated by
townie](./render-load-balancer/townie-performance-test.png)](https://maxm-governingvioletkrill.web.val.run/)

You'll see that generally they both do pretty well, but Render is a little
slower and sometimes has much higher tail latencies.

Render has mentioned that
they're working on improving this, and it certainly seems better than when I was
first testing, so maybe things will change in the future.

## Don't wrap your FaaS in a FaaS

After some investigation it turns out the slowdown is because Render routes
every incoming request through a Cloudflare Worker. So we're not just seeing the
geographic cost of hopping over to Cloudflare, but we're also seeing the
occasional cold start or whatever scheduling congesting might be involved in
finding available capacity.

We're building a [FaaS](https://en.wikipedia.org/wiki/Function_as_a_service)! We
can't wrap our FaaS in another FaaS. We have cold starts and scheduling and
worker re-use and resource problems to deal with. If we're fighting to reduce
tail latencies and Cloudflare Workers have their own tail latencies we have less
control over our performance than we'd like.

We talked to Render. They were nice, and helpful, and read my benchmarks. They
confirmed the issue, but where unwilling to remove their Cloudflare layer or
help us find out a way to get around it.

What do we do next?

##

